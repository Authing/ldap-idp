!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";const e=require("ldapjs");function r(r,t,n){var o=r instanceof e.SearchRequest;return r.connection.ldap.bindDN.equals("cn=root")||o?n():n(new e.InsufficientAccessRightsError)}var t="o=joyent",n={},o=e.createServer();o.bind("cn=root",function(r,t,n){return"cn=root"!==r.dn.toString()||"secret"!==r.credentials?n(new e.InvalidCredentialsError):(t.end(),n())}),o.add(t,r,function(r,t,o){var i=r.dn.toString();return n[i]?o(new e.EntryAlreadyExistsError(i)):(n[i]=r.toObject().attributes,t.end(),o())}),o.bind(t,function(r,t,o){var i=r.dn.toString();return n[i]?n[i].userpassword?-1===n[i].userpassword.indexOf(r.credentials)?o(new e.InvalidCredentialsError):(t.end(),o()):o(new e.NoSuchAttributeError("userPassword")):o(new e.NoSuchObjectError(i))}),o.compare(t,r,function(r,t,o){var i=r.dn.toString();if(!n[i])return o(new e.NoSuchObjectError(i));if(!n[i][r.attribute])return o(new e.NoSuchAttributeError(r.attribute));for(var a=!1,c=n[i][r.attribute],u=0;u<c.length;u++)if(c[u]===r.value){a=!0;break}return t.end(a),o()}),o.del(t,r,function(r,t,o){var i=r.dn.toString();return n[i]?(delete n[i],t.end(),o()):o(new e.NoSuchObjectError(i))}),o.modify(t,r,function(r,t,o){const i=r.dn.toString();let a=null;if(!r.changes.length)return o(new e.ProtocolError("changes required"));if(!n[i])return o(new e.NoSuchObjectError(i));for(var c=n[i],u=0;u<r.changes.length;u++)switch(a=r.changes[u].modification,r.changes[u].operation){case"replace":if(!c[a.type])return o(new e.NoSuchAttributeError(a.type));a.vals&&a.vals.length?c[a.type]=a.vals:delete c[a.type];break;case"add":c[a.type]?a.vals.forEach(function(e){-1===c[a.type].indexOf(e)&&c[a.type].push(e)}):c[a.type]=a.vals;break;case"delete":if(!c[a.type])return o(new e.NoSuchAttributeError(a.type));delete c[a.type]}return t.end(),o()}),o.search(t,r,function(r,t,o){var i,a=r.dn.toString();if(!n[a])return o(new e.NoSuchObjectError(a));switch(r.scope){case"base":return r.filter.matches(n[a])&&t.send({dn:a,attributes:n[a]}),t.end(),o();case"one":i=function(t){if(r.dn.equals(t))return!0;var n=e.parseDN(t).parent();return!!n&&n.equals(r.dn)};break;case"sub":i=function(e){return r.dn.equals(e)||r.dn.parentOf(e)}}return Object.keys(n).forEach(function(e){i(e)&&r.filter.matches(n[e])&&t.send({dn:e,attributes:n[e]})}),t.end(),o()}),o.listen(1389,function(){console.log("LDAP server up at: %s",o.url)})});
//# sourceMappingURL=ldap-idp.umd.production.js.map
